<h2 class="font-bold text-2xl mb-6">Detalle de la solicitud</h2>

<div *ngIf="detalle as d">
  <p class="text-sm text-gray-600 mb-4">ID de la solicitud: <strong>{{ id }}</strong></p>

  <!-- Información general -->
  <mat-card class="mb-6">
    <mat-card-title>Información General</mat-card-title>
    <mat-card-content>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <p><strong>Descripción de falla:</strong> {{ d.descripcionDeFalla }}</p>
          <p><strong>Estado:</strong> {{ d.estado }}</p>
        </div>
        <div>
          <p><strong>Usuario:</strong> {{ d.usuario.user }}</p>
        </div>
        <div>
          <p><strong>Placa del bus:</strong> {{ d.bus.placa }}</p>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Repuestos -->
  <h3 class="font-semibold mt-4 mb-2">Repuestos</h3>
  <table mat-table [dataSource]="d.detalleRepuestos" class="mat-elevation-z2 w-full mb-6">
    <ng-container matColumnDef="index">
      <th mat-header-cell *matHeaderCellDef>#</th>
      <td mat-cell *matCellDef="let _; let i = index">{{ i + 1 }}</td>
    </ng-container>

    <ng-container matColumnDef="nombreRepuesto">
      <th mat-header-cell *matHeaderCellDef>Nombre</th>
      <td mat-cell *matCellDef="let e">{{ e.nombreRepuesto }}</td>
    </ng-container>

    <ng-container matColumnDef="cantidad">
      <th mat-header-cell *matHeaderCellDef>Cantidad</th>
      <td mat-cell *matCellDef="let e">{{ e.cantidad }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="['index', 'nombreRepuesto', 'cantidad']"></tr>
    <tr mat-row *matRowDef="let row; columns: ['index', 'nombreRepuesto', 'cantidad']"></tr>
  </table>

  <!-- Herramientas -->
  <h3 class="font-semibold mt-6 mb-2">Herramientas</h3>
  <table mat-table [dataSource]="d.detalleHerramientas" class="mat-elevation-z2 w-full mb-6">
    <ng-container matColumnDef="index">
      <th mat-header-cell *matHeaderCellDef>#</th>
      <td mat-cell *matCellDef="let _; let i = index">{{ i + 1 }}</td>
    </ng-container>

    <ng-container matColumnDef="nombreHerramienta">
      <th mat-header-cell *matHeaderCellDef>Nombre</th>
      <td mat-cell *matCellDef="let e">{{ e.nombreHerramienta }}</td>
    </ng-container>

    <ng-container matColumnDef="cantidad">
      <th mat-header-cell *matHeaderCellDef>Cantidad</th>
      <td mat-cell *matCellDef="let e">{{ e.cantidad }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="['index', 'nombreHerramienta', 'cantidad']"></tr>
    <tr mat-row *matRowDef="let row; columns: ['index', 'nombreHerramienta', 'cantidad']"></tr>
  </table>

  <!-- Observación para revisión -->
  <mat-form-field appearance="outline" class="w-full">
    <mat-label>Motivo u observación</mat-label>
    <textarea
      matInput
      [(ngModel)]="observacionRevision"
      rows="3"
      placeholder="Describa el motivo u observación de rechazo o revisión"
    ></textarea>
  </mat-form-field>

  <!-- Botones de acción -->
  <div class="flex gap-4 mt-6">
    <button mat-raised-button color="primary" (click)="aprobar()">Aprobar</button>
    <button mat-raised-button color="warn" (click)="rechazar()">Rechazar</button>
  </div>
</div>
